!function(e,n,o,i,r){"use strict";var u=e.module("Notes",["restangular","ngRoute"]).config(["$provide","$routeProvider","RestangularProvider","$httpProvider","$windowProvider",function(e,t,n,i,r){i.defaults.headers.common.requesttoken=o,e.value("Constants",{saveInterval:5e3}),t.when("/notes/:noteId",{templateUrl:"note.html",controller:"NoteController",resolve:{note:["$route","$q","is","Restangular",function(e,t,n,o){var i=t.defer(),r=e.current.params.noteId;return n.loading=!0,o.one("notes",r).get().then(function(e){n.loading=!1,i.resolve(e)},function(){n.loading=!1,i.reject()}),i.promise}]}}).otherwise({redirectTo:"/"});var u=OC.generateUrl("/apps/notes");n.setBaseUrl(u)}]).run(["$rootScope","$location","NotesModel",function(e,t,o){n('link[rel="shortcut icon"]').attr("href",OC.filePath("notes","img","favicon.png")),e.$on("$routeChangeError",function(){var e=o.getAll();if(e.length>0){var n=e.sort(function(e,t){return e.modified>t.modified?1:e.modified<t.modified?-1:0}),i=e[n.length-1];t.path("/notes/"+i.id)}else t.path("/")})}]);u.controller("AppController",["$scope","$location","is",function(e,t,n){e.is=n,e.init=function(e){0!==e&&t.path("/notes/"+e)}}]),u.controller("NoteController",["$routeParams","$scope","NotesModel","SaveQueue","note",function(e,n,o,i,r){o.updateIfExists(r),n.note=o.get(e.noteId),n.isSaving=function(){return i.isSaving()},n.updateTitle=function(){n.note.title=n.note.content.split("\n")[0]||t("notes","New note")},n.save=function(){var e=n.note;i.add(e)},n.toggleDistractionFree=function(){function e(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}function t(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement?t():e(document.getElementById("app-content"))}}]),u.controller("NotesController",["$routeParams","$scope","$location","Restangular","NotesModel",function(e,t,n,o,i){t.route=e,t.notes=i.getAll();var r=o.all("notes");r.getList().then(function(e){i.addAll(e)}),t.create=function(){r.post().then(function(e){i.add(e),n.path("/notes/"+e.id)})},t["delete"]=function(e){var n=i.get(e);n.remove().then(function(){i.remove(e),t.$emit("$routeChangeError")})},t.toggleFavorite=function(e){var t=i.get(e);t.customPUT({favorite:!t.favorite},"favorite",{},{}).then(function(e){t.favorite=!!e})}}]),u.directive("notesAutofocus",function(){return{restrict:"A",link:function(e,t){t.focus()}}}),u.directive("editor",["$timeout",function(e){return{restrict:"A",link:function(t,o){var r=i(o[0],{change:function(n){e(function(){t.$apply(function(){t.note.content=n,t.updateTitle()})})}});r.setValue(t.note.content),o.on("click",".link",function(e){if(e.ctrlKey){var t=n(this).find(".link-params-inner").text();window.open(t,"_blank")}})}}}]),u.directive("notesIsSaving",["$window",function(e){return{restrict:"A",scope:{notesIsSaving:"="},link:function(n){e.onbeforeunload=function(){return n.notesIsSaving?t("notes","Note is currently saving. Leaving the page will delete all changes!"):null}}}}]),u.directive("notesTimeoutChange",["$timeout",function(e){return{restrict:"A",link:function(t,o,i){var r,u=300;n(o).bind("input propertychange paste",function(){e.cancel(r),r=e(function(){t.$apply(i.notesTimeoutChange)},u)})}}}]),u.directive("notesTooltip",function(){return{restrict:"A",link:function(e,t){t.tooltip({container:"body"})}}}),u.filter("noteTitle",function(){return function(e){return e=e.split("\n")[0]||"newNote",e.trim().replace(/^#+/g,"")}}),u.filter("wordCount",function(){return function(e){if(e&&"string"==typeof e){var t=e.split(/\s+/).filter(function(e){return e.search(/[A-Za-z0-9]/)!==-1}).length;return window.n("notes","%n word","%n words",t)}return 0}}),u.factory("is",function(){return{loading:!1}}),u.factory("NotesModel",function(){var t=function(){this.notes=[],this.notesIds={}};return t.prototype={addAll:function(e){for(var t=0;t<e.length;t+=1)this.add(e[t])},add:function(e){this.updateIfExists(e)},getAll:function(){return this.notes},get:function(e){return this.notesIds[e]},updateIfExists:function(t){var n=this.notesIds[t.id];e.isDefined(n)?(n.title=t.title,n.modified=t.modified,n.content=t.content,n.favorite=t.favorite):(this.notes.push(t),this.notesIds[t.id]=t)},remove:function(e){for(var t=0;t<this.notes.length;t+=1){var n=this.notes[t];if(n.id===e){this.notes.splice(t,1),delete this.notesIds[e];break}}}},new t}),u.factory("SaveQueue",["$q",function(e){var t=function(){this._queue={},this._flushLock=!1};return t.prototype={add:function(e){this._queue[e.id]=e,this._flush()},_flush:function(){var t=Object.keys(this._queue);if(0!==t.length&&!this._flushLock){this._flushLock=!0;for(var n=this,o=[],i=0;i<t.length;i+=1){var r=this._queue[t[i]];o.push(r.put().then(this._noteUpdateRequest.bind(null,r)))}this._queue={},e.all(o).then(function(){n._flushLock=!1,n._flush()})}},_noteUpdateRequest:function(e,t){e.title=t.title,e.modified=t.modified},isSaving:function(){return this._flushLock}},new t}])}(angular,jQuery,oc_requesttoken,mdEdit);
//# sourceMappingURL=app.min.js.map
